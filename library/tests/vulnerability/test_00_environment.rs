/*
whitebeam_test!("linux", vulnerability_LD_PRELOAD_LD_AUDIT {
    // Ensure that Prevention blocks non-whitelisted LD_PRELOAD and LD_AUDIT libraries specified by environment variables
    // Ref: https://github.com/WhiteBeamSec/WhiteBeam/security/advisories/GHSA-mm3f-f5hg-p2hv
    println!("Hello vulnerability test for Linux!");
});
*/

whitebeam_test!("linux", vulnerability_LD_BIND_NOW {
    // Ensure that specifying LD_BIND_NOW causes programs to abort
    let baseline_true_exit = std::process::Command::new("/usr/bin/true").status().expect("true command failed to start");
    assert!(baseline_true_exit.success());
    let bind_now_true_exit = std::process::Command::new("/usr/bin/true")
        .stderr(std::process::Stdio::null())
        .env("LD_BIND_NOW", "1").status().expect("true command failed to start");
    assert!(!(bind_now_true_exit.success()));
});